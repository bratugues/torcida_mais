<!-- app/views/devise/registrations/edit.html.erb -->
<h2 class="visually-hidden">Edit profile</h2>

<%= simple_form_for(resource, as: resource_name,
      url: registration_path(resource_name),
      html: { method: :put, multipart: true, class: "profile-card" }) do |f| %>

  <%= f.error_notification %>

  <!-- Avatar -->
  <div class="profile-avatar text-center">
    <% if resource.photo&.attached? %>
      <%= image_tag resource.photo.variant(resize_to_fill: [96,96]).processed,
                    class: "avatar-xl", alt: "Your avatar" %>
    <% else %>
      <div class="avatar-xl avatar-placeholder"></div>
    <% end %>

    <div class="mt-2">
      <%= f.input :photo, as: :file, label: "Profile picture", input_html: { class: "form-control" } %>
    </div>
  </div>

  <!-- Main fields -->
  <div class="profile-fields">
    <%= f.input :name,     label: "Full name",  placeholder: "Enter your full name" %>
    <%= f.input :username, label: "Username",   placeholder: "Enter your username" %>
    <%= f.input :location, label: "Location",   placeholder: "City / Neighborhood" %>
  </div>

  <!-- Toggle Bar + conditional fields -->
  <div data-controller="toggle" class="profile-bar mt-3">
    <div class="form-check mb-2">
      <%= f.check_box :bar,
            class: "form-check-input",
            data: { action: "toggle#switch", toggle_target: "checkbox" } %>
      <%= f.label :bar, "I own a bar / venue", class: "form-check-label ms-1" %>
    </div>

    <div data-toggle-target="panel" class="<%= resource.bar? ? '' : 'd-none' %>">
      <%= f.input :bar_name,    label: "Bar name",    placeholder: "Example: The Corner Pub" %>
      <%= f.input :bar_address, label: "Bar address", placeholder: "Street, number, city" %>
    </div>
  </div>

  <!-- Passwords (Devise) -->
  <div class="profile-security mt-3">
    <%= f.input :password,              label: "New password",
                hint: "Leave blank if you donâ€™t want to change it",
                required: false, input_html: { autocomplete: "new-password" } %>
    <%= f.input :password_confirmation, label: "Confirm new password",
                required: false, input_html: { autocomplete: "new-password" } %>
    <%= f.input :current_password,      label: "Current password",
                hint: "We need your current password to confirm changes",
                required: true, input_html: { autocomplete: "current-password" } %>
  </div>

  <div class="d-grid mt-3">
    <%= f.button :submit, "Save changes", class: "btn btn-profile" %>
  </div>
<% end %>

<!-- Danger zone -->
<div class="mt-3 text-center">
  <%= button_to "Delete my account",
        destroy_user_registration_path,
        method: :delete,
        data: { turbo_confirm: "Are you sure you want to delete your account?" },
        class: "btn-secondary" %>
</div>
